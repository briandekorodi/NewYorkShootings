---
title: "NewYorkShootings"
author: "Brian de Korodi & Mariane Modena"
format: pdf
editor: visual
---

# Gun violence in the Big Apple: How shooting incidents help to tell the story of New York City over the last 15 years.

A city of bright lights and big dreams, New York's history is also one of crime, violence and social inequality. This is why we will attempt to tell the story of New York City through the lens of its shooting incidents.

Through geographical, sociodemographic and temporal aspects of reported shooting incidents in New York City, we attempt to find relevant trends that might align with social and economic developments between 2006 and 2022.

We have found certified data with detailed descriptive characteristics of all reported shooting incidents, including date, time, location, victim and offender's characteristics. This will allow us to summarize the quantity of shooting incidents as a function of these characteristics, along with their evolution over the given timeframe. Where significant patterns reveal themselves, we will attempt to use external information to help explain these patterns in light of various contextual factors, such as political, social, or economic evolutions.Â 

This method, combining descriptive data with contextual information, we hope, will allow us to determine to what extent gun violence incidents are random events, or whether they may be partially explained by larger social and economic forces.

## Click [here](https://github.com/briandekorodi/NewYorkShootings) to access the Github repository

## Click [here](https://catalog.data.gov/dataset/nypd-shooting-incident-data-historic/resource/c564b578-fd8a-4005-8365-34150d306cc4) to access the source

## Description of the source

The data, found in the official United States open data website, constitutes a list of every New York City shooting incident, reported by the NYPD, from January 1, 2006 to Decemeber 31, 2022. This data is manually extracted every quarter and reviewed by the Office of Management Analysis and Planning before being posted on the NYPD website.

For each observation, corresponding to a unique shooting incident, is provided information relative to the date, time and localisation of the incident, as well as socio-demographic characteristics of the offender and victim.

## Description of the variables

**INCIDENT_KEY** : Serial number identifying the incident

**OCCUR_DATE** : Date (Month/Day/Year) on which the incident occurred

**OCCUR_TIME** : Time at which the incident occured

**BORO** : Which of the 5 New York City boroughs the incident occurred in (Manhattan, Queens, Brooklyn, Bronx, Staten Island)

**LOC_OF_OCCUR_DESC** : Most general category of location, whether the incident occurred inside ,outside, or unknown

**PRECINCT** : Code identifying which NYPD precinct in which the incident occurred

**JURISDICTION_CODE** : Code identifying the tax jurisdiction territory in which the incident occurred

**LOC_CLASSFCTN_DESC** : Second most general category of location

**LOCATION_DESC** : Third most general category of location

**STATISTICAL_MURDER_FLAG** : TRUE/FALSE variable indicating whether the shooting resulted in a murder

**PERP_AGE_GROUP** : Age range of the offender

**PERP_SEX** : Sex of the offender

**PERP_RACE** : Racial group of the offender

**VIC_AGE_GROUP** : Age range of the victim

**VIC_SEX** : Sex of the victim

**VIC_RACE** : Racial group of the victim

**X_COORD_CD** : Cartesian X coordinate of the location at which the shooting incident occurred

**Y_COORD_CD** : Cartesian Y coordinate of the location at which the shooting incident occurred

**Latitude** : Geographical latitude coordinate of the location at which the shooting incident occurred

**Longitude** : Geographical longitude coordinate of the location at which the shooting incident occurred

**Lon_Lat** : Geographical point, composed of latitude and longitude coordinates, of the location at which the shooting incident occurred

## Loading the data

```{r}
#| message: FALSE
here::i_am("NewYorkShootings.Rproj")
```

```{r}
library(vroom)
```

```{r}

raw_data <- vroom("data/NYPD_Shooting_Incident_Data__Historic.csv")
```

## Data Cleaning

```{r}
library(dplyr)
```

We create a new dataset on which we will implement our cleaning steps.

```{r}
clean_data <- raw_data
```

### Inconsistent labeling of missing values

The dataset contains some inconsistencies in the entry of missing values. Some missing values are labeled NA, while others are labeled with some other character value, such as "(null)", "UNKNOWN", "U", or "OTHER". We convert all of these to NA.

#### Null

The location description and offender age group variables contain missing values that have the notation "(null)".

```{r}
clean_data |> distinct(LOCATION_DESC)
```

```{r}
clean_data |> distinct(PERP_AGE_GROUP)
```

We replace all the "(null)" values in the dataset by NA.

```{r}
clean_data[clean_data == "(null)"] <- NA
```

#### NONE

The location description variable contains some missing values labeled as NONE. We replace these by NA.

```{r}
clean_data[clean_data == "NONE"] <- NA
```

#### UNKNOWN

The victim age group variable contains some missing values labeled as UNKNOWN. We replace these by NA.

```{r}
clean_data |> distinct(VIC_AGE_GROUP)
```

```{r}
clean_data |> distinct(PERP_AGE_GROUP)
```

```{r}
clean_data[clean_data == "UNKNOWN"] <- NA
```

#### OTHER

The location classification variable contains some missing values labeled as OTHER. We replace these by NA.

```{r}
clean_data |> distinct(LOC_CLASSFCTN_DESC)
```

```{r}
clean_data[clean_data == "OTHER"] <- NA
```

#### U

The victim and offender sex variables contain some missing values labeled as U. We replace these by NA.

```{r}
clean_data |> distinct(PERP_SEX)
```

```{r}
clean_data |> distinct(VIC_SEX)
```

```{r}
clean_data[clean_data == "U"] <- NA
```

### Impossible values

The victim and offender age group variables contain some absurd values. It is impossible that the victim's age be 1022, or that the offender's age be 1020, 940 or 224. We replace these values by NA.

```{r}
clean_data |> distinct(VIC_AGE_GROUP)
```

```{r}
clean_data |> distinct(PERP_AGE_GROUP)
```

```{r}
clean_data <- clean_data |>
  mutate(VIC_AGE_GROUP = ifelse(!VIC_AGE_GROUP %in% c("<18", "18-24", "25-44", "45-64", "65+"), NA, VIC_AGE_GROUP),
         PERP_AGE_GROUP = ifelse(!PERP_AGE_GROUP %in% c("<18", "18-24", "25-44", "45-64", "65+"), NA, PERP_AGE_GROUP))
```

### Typos

The location description variable contains some values with typos. We correct these.

```{r}
clean_data |> distinct(LOCATION_DESC)
```

```{r}
clean_data <- clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUS" =  "MULTI DWELL - PUBLIC HOUSE", 
                                "SOCIAL CLUB/POLICY LOCATI" = "SOCIAL CLUB/POLICY LOCATION"))
```

### Wrong types

Depending on the computer, he variable OCCUR_TIME may have a double type, which means its values take on a "... secs" format, rather than a "hours/minutes/seconds" format. This not very readable.

```{r}
#In case this issue arises
#clean_data[["OCCUR_TIME"]] |> typeof()
```

We us as_hms to convert it from double to time.

```{r}
#In case this issue arises
library(hms)
clean_data[["OCCUR_TIME"]] <- clean_data[["OCCUR_TIME"]] |> as_hms()
```

we change the type of OCCUR_DATE from character to date.

```{r}
clean_data[["OCCUR_DATE"]] <- clean_data[["OCCUR_DATE"]] |> as.Date(format="%m/%d/%Y")
```

## Basic information about the data file

```{r}
basic_info <- clean_data |>
  summarise("Name of the file" = gsub(".csv","", list.files("data")),
            "File content" = "Reported shooting incidents in New York City",
            "Number of observations" = nrow(clean_data),
            "Number of variables" = ncol(clean_data),
            "Date of first observation" = last(OCCUR_DATE),
            "Date of last observation" = first(OCCUR_DATE),
            "Number of numerical variables" = length(select_if(clean_data,is.numeric)),
            "Number of character variables" = length(select_if(clean_data,is.character)),
            "Number of logical variables" = length(select_if(clean_data,is.logical)),
            "Number of time variables" = length(select_if(clean_data,is_hms)),
            "Proportion of missing values" = (sum(is.na(clean_data)))/((nrow(clean_data))*(ncol(clean_data))))
knitr::kable(basic_info)

```

## A first look

```{r}
library(ggplot2)
```

```{r}
clean_data |>
  filter(!is.na(Longitude) & !is.na(Latitude)) |>
  ggplot(aes(x=Longitude, y=Latitude, color=BORO))+
  geom_point() +
  labs(title = "Locations of shooting incidents in New York City, 2006-2022")
```

![Map of New York City](NYC_Map.png){fig-align="center" width="310"}

Nothing illustrates the tight link between New York City and its history of gun violence quite like the near reproduction of the city map simply by plotting all shooting incidents according to their geographical coordinates.

On this note, we will attempt to further deconstruct the patterns behind this remarkable data.

### NA values

Before starting our analysis, it useful to produce an overview of the NA values in the dataset.

```{r}
library(tidyverse)

clean_data |>
  summarise_all(~ sum(is.na(.))/nrow(clean_data)) |>
  pivot_longer(cols = 1:21, names_to = "Variable", values_to = "proportion of NA") |>
  ggplot(aes(y=Variable, x=`proportion of NA`)) +
  geom_col() +
  labs(title="Proportion of NA values per variable")
```

The variables related to shooting locations and offender characteristics (age, sex, race) clearly contain high proportions of NA values whereas most of the other variables don't have any.

This needs to be carefully taken into account in any further analysis involving those variables, as the results that will be obtained might not be accurate, especially for the location variables that miss more than 50% of their values.

### Shootings over time in New York City

Without any grouping :

```{r}
library(lubridate)

clean_data |>
  mutate("year"=year(OCCUR_DATE)) |>
  #filter(year == 2020) |>
  group_by(OCCUR_DATE) |>
  summarise("Shooting incidents" = n()) |>
  ggplot(aes(x = `OCCUR_DATE`, y = `Shooting incidents`)) +
  geom_line() 
```

clearly there are too many dates...

Grouping by year :

```{r}
library(lubridate)

  clean_data |>
  select(OCCUR_DATE) |>
  mutate('year'=year(OCCUR_DATE))|>
  group_by(year)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=1))) +
    labs(title="Number of shooting incidents in NYC over the years ")
```

Grouping by year and by Boroughs :

```{r}
 clean_data |>
  select(OCCUR_DATE, BORO) |>
  mutate('year'=year(OCCUR_DATE))|>
  group_by(year, BORO)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`, group=BORO, color=BORO)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=2))) +
    labs(title="Number of shooting incidents by boroughs over the years ")
```

### Shootings by precinct

*"Gun violence remains a pervasive issue in small pockets of neighborhoods around New York City. The data shows that a limited number of communities have accounted for roughly 50% of NYC's shooting incidents."*

[NYC Mayor's Office of Criminal Justice](https://criminaljustice.cityofnewyork.us/programs/office-to-prevent-gun-violence/)

```{r}
knitr::kable(clean_data |>
    group_by(PRECINCT) |>
    summarise('Number of shootings' = n()) |>
    mutate('pct' = round((100*(prop.table(`Number of shootings`))), 2)) |>
    arrange(desc(`pct`))
)
```

The table confirms the above statement: out of a total of 77 police precincts in New York City, there is a group of 14 that account for over 50% of the total shooting incidents from 2006 - 2022.

### Decrease in gun violence 2006-2019, looking at precincts

```{r}
violent_precincts <- c("75", "73", "67", "44", "79", "47", "40", "46", "42", "113", "81", "77", "48", "43")
mid_upper_violent_precincts <- c("32","103","52","71","120","83","41","101","23","105","69","25","70","60","114","49","28","34","90","63","88","30","33","106")
mid_lower_violent_precincts <- c("102","45","115","100","76","110","50","61","26","84","109","121","7","9","72","24","104","107","94","10","62","108","78","13","122")
nonviolent_precincts <- c("5","14","66","20","18","68","123","6","1","112","19","17","111","22")
```

```{r}
 clean_data |>
  select(OCCUR_DATE, PRECINCT, BORO) |>
  filter(PRECINCT %in% violent_precincts) |>
  mutate('year'=year(OCCUR_DATE))|>
  filter(`year` < 2020) |>
  group_by(year, PRECINCT, BORO)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`, group=PRECINCT, color = BORO)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=2))) +
    labs(title="Number of shooting incidents by precinct over the years ")
```

```{r}
 clean_data |>
  select(OCCUR_DATE, PRECINCT, BORO) |>
  filter(PRECINCT %in% mid_upper_violent_precincts) |>
  mutate('year'=year(OCCUR_DATE))|>
  filter(`year` < 2020) |>
  group_by(year, PRECINCT, BORO)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`, group=PRECINCT, color = BORO)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=2))) +
    labs(title="Number of shooting incidents by precinct over the years ")
```

```{r}
 clean_data |>
  select(OCCUR_DATE, PRECINCT, BORO) |>
  filter(PRECINCT %in% mid_lower_violent_precincts) |>
  mutate('year'=year(OCCUR_DATE))|>
   filter(`year` < 2020) |>
  group_by(year, PRECINCT, BORO)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`, group=PRECINCT, color = BORO)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=2))) +
    labs(title="Number of shooting incidents by precinct over the years ")
```

```{r}
 clean_data |>
  select(OCCUR_DATE, PRECINCT, BORO) |>
  filter(PRECINCT %in% nonviolent_precincts) |>
  mutate('year'=year(OCCUR_DATE))|>
   filter(`year` < 2020) |>
  group_by(year, PRECINCT, BORO)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`, group=PRECINCT, color = BORO)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=2))) +
    labs(title="Number of shooting incidents by precinct over the years ")
```

### Visualizing violent and non violent precincts over time : NYC maps

```{r}
library(sf)

nyc_precincts <- st_read("data/NYC_precincts/geo_export_67d4adff-9e57-4cd6-91b7-03cb65ec7fec.shp")

#nyc_boroughs <- st_read("data/NYC_boroughs/geo_export_d3400c99-9a69-4d69-825e-f2fe32c664a1.shp")
```

```{r}
shootings_precincts_per_periods <-
  clean_data |>
    mutate("year"=year(OCCUR_DATE), "period"=case_when(
      2006 <= year & year <= 2011 ~ "2006-2011",
      2012 <= year & year <=2019 ~ "2012-2019",
      2020 <= year & year <= 2022 ~ "2020-2022")) |>
    group_by(PRECINCT, period) |>
    summarise('Total number of shootings'=n()) |>
    rename("precinct"=PRECINCT) |>
    mutate("Average number of shootings" = case_when(
      period == "2006-2011" ~ `Total number of shootings`/6 , 
      period == "2012-2019" ~ `Total number of shootings`/8,
      period == "2020-2022" ~ `Total number of shootings`/3))
```

```{r}
# add spacial coordinates to the previous dataset

shootings_precincts_years <- shootings_precincts_years |> 
  left_join(nyc_precincts) 
```

```{r}
ggplot() +
  geom_sf(data = shootings_precincts_years, aes(geometry=geometry, fill=`Average number of shootings`)) +
  facet_wrap(~ period, nrow=2) +
  scale_fill_continuous(trans = 'reverse') +
  labs(title = "Average number of shooting incidents per year in the different NYC precincts", subtitle = "over 3 periods of time")



```

During the period 2012-2019, the average number of shooting incidents per year decreased in the most violent precincts of the period 2006-2011 (those in darker blue). But during the Covid period (2020-2022), it started increasing again.

### It's cold outside: Average shootings by month of the year

```{r}
months_association <- data.frame("month name"=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), "month"=c(1,2,3,4,5,6,7,8,9,10,11,12)
)
```

```{r}
library(tidyverse) 

clean_data |>
  select(OCCUR_DATE) |>
  mutate('month'=month(OCCUR_DATE))|>
  group_by(month)|>
  summarise('Average number of shooting incidents'= n()/16) |>
  left_join(months_association) |>
  ggplot(aes(x=fct_inorder(month.name), y=`Average number of shooting incidents`)) +
  geom_col() +
  labs(x="Month", title="Average number of shooting incidents per month in NYC", subtitle="over the period 2006-2022")
```

### Shooting incidents in NYC during each US President's term

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)

presidents <- clean_data |>
  select(OCCUR_DATE) |>
  mutate('year'=year(OCCUR_DATE))|>
  group_by(year)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=1))) +
    labs(title="Number of shooting incidents in NYC over the years ") +
    geom_vline(xintercept = 2006, color = "red") +
    geom_vline(xintercept = 2009, color = "red") +
    geom_vline(xintercept = 2017, color = "red") +
    geom_vline(xintercept = 2021, color = "red")
  
install.packages("png")
library(png)

here::i_am("NewYorkShootings.Rproj")


Bush_img <- readPNG("pngimg.com - geaorge_bush_PNG16.png", native = TRUE)
Obama_img <- readPNG("pngwing.com.png", native = TRUE)
Trump_img <- readPNG("trump.png", native = TRUE)
Covid_img <- readPNG("covid.png", native = TRUE)
Biden_img <- readPNG("joe-biden-40972.png", native = TRUE)


install.packages("patchwork")
library(patchwork)

presidents_img <- presidents +                   
  inset_element(p = Bush_img, 
                left = 0.1, 
                bottom = 0.5, 
                right = 0.2, 
                top = 0.35) +                   
  inset_element(p = Obama_img, 
                left = 0.225, 
                bottom = 0.35, 
                right = 0.4, 
                top = 0.01) +                   
  inset_element(p = Trump_img,
                left = 0.69, 
                bottom = 0.15, 
                right = 0.78, 
                top = 0.6) +                   
  inset_element(p = Covid_img, 
                left = 0.8, 
                bottom = 0.98, 
                right = 0.85, 
                top = 0.9) +                   
  inset_element(p = Biden_img, 
                left = 0.91, 
                bottom = 0.4, 
                right = 0.99, 
                top = 0.65) 

print(presidents_img)
```

George W. Bush, 2006-2009

Barack Obama, 2009-2017

Donald J. Trump, 2017-2021

Joe Biden, 2021-present

### NYC shootings during Mayors' terms

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)

mayors <- clean_data |>
  select(OCCUR_DATE) |>
  mutate('year'=year(OCCUR_DATE))|>
  group_by(year)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=1))) +
    labs(title="Number of shooting incidents in NYC over the years ") +
    geom_vline(xintercept = 2013, color = "red") +
    geom_vline(xintercept = 2021, color = "red")
  
install.packages("png")
library(png)

here::i_am("NewYorkShootings.Rproj")


Bloomberg_img <- readPNG("Bloomberg.png", native = TRUE)
DeBlasio_img <- readPNG("deblasio.png", native = TRUE)
Adams_img <- readPNG("adams.png", native = TRUE)



install.packages("patchwork")
library(patchwork)

mayors_img <- mayors +                   
  inset_element(p = Bloomberg_img, 
                left = 0.1, 
                bottom = 0.5, 
                right = 0.2, 
                top = 0.35) +                   
  inset_element(p = DeBlasio_img, 
                left = 0.6, 
                bottom = 0.6, 
                right = 0.7, 
                top = 0.75) +                   
  inset_element(p = Adams_img,
                left = 0.91, 
                bottom = 0.15, 
                right = 0.98, 
                top = 0.6)

print(mayors_img)
```

Michael R. Bloomberg, 2003-2013

*"In 2006, former New York City Mayor Michael Bloomberg and former Boston Mayor Thomas Menino founded Mayors Against Illegal Guns as a coalition of 15 mayors. Since then, they have built a bipartisan group of more than 1,000 current and former mayors from nearly every state to fight for common-sense gun laws."*

\- [DMO](https://nationaldmo.org/about/advisoryboard/dmo_maig/)

*"New York City's murder rate is expected to hit a record low this year, and shootings are at their lowest point in at least 18 years. Mayor Bloomberg and Police Commissioner Ray Kelly credited police efforts, including the controversial tactic known as stop and frisk, and Bloomberg said the statistics showed"that the safest big city in America is safer." \[...\] Tracking neighborhoods where violence is spiking and assigning more officers there has helped drive down shootings, officials said. Kelly also cited stop and frisk, a practice in which officers stop, question and sometimes pat down people they think might be doing something criminal, even if the suspicions don't meet the probable-cause standard for an arrest. \[...\] The NYPD began increasing its focus on stop and frisk as a crime-fighting tool in the mid-1990s. The stops have rocketed up on Bloomberg's 11-year watch, hitting a high of 684,330 last year."*

\- [NBC New York](https://www.nbcnewyork.com/news/local/nyc-murder-rate-record-low-crime-stats-nypd/2095430/), December 2012

Bill de Blasio, 2004-2021

*"New York City Mayor Bill de Blasio has joined the pro-gun control group started by his predecessor. \[...\]"We are taking every step within our power to protect our people, and we need our leaders in Washington and other states across the country to do the same. Mayor Bloomberg took on this fight when few others would, and today we are safer for it. He built a national movement for commonsense gun control - one I am proud to join. We are going to force this issue on the national stage to protect New Yorkers from the illegal guns flooding into our city," said Mayor Bill de Blasio."*

\- [CBS News](https://www.cbsnews.com/newyork/news/de-blasio-joins-mayors-against-illegal-guns-pledges-aggressive-action/), January 2014

*"It's going to be a long, bloody summer in the city, Mayor Bill de Blasiowarned Monday --- while offering no new solutions on how to combat the Big Apple's staggering gun violence. \[...\] Murders have risen nearly 12 percent so far this year, too, but compared to 2019, that figure soars to nearly 50 percent. \[...\] A Brooklyn detective added that the mayor "has nerve'' to blame the city's woes on everyone and everything else."*

\- [The New York Post](https://nypost.com/2021/06/07/bill-de-blasio-offers-no-solution-to-surging-gun-violence/), June 2021

Yet de Blasio on Monday offered nothing in the way of new ideas to stem the crime crisis.

Eric L. Adams, 2022-present

*"With shootings on the rise in New York City, Mayor Eric Adams on Thursday named as his new "gun czar" the head of a taxpayer-funded "violence interrupter" nonprofit whom investigators had found used the group to line his pockets and employ his relatives. Andre Mitchell, executive director of the nonprofit Man Up Inc, will serve as volunteer co-chair of a task force addressing gun violence as part of Adams' campaign to reverse the trend of mayhem that's plagued city streets since just prior to the pandemic."*

\- [The City](https://www.thecity.nyc/2022/06/02/eric-adams-andre-mitchell-man-up-gun-czar/), June 2022

*"Millions of New Yorkers and tourists flock to Times Square to see Broadway shows, enjoy a good meal, and take photos of the neon billboards, and we will not allow them to live in fear or distrust that someone is walking around with a gun ready to harm them," said Mayor Adams. "Today, with the signing of Intro. 602, we enshrine into law that Times Square is a gun free zone, and Intro. 518-A will help us address the flow of illegal guns into our city. We will continue to work with our partners on the City Council to dam the many rivers feeding the sea of gun violence and keep New Yorkers safe."*

\- [Office of the Mayor](https://www.nyc.gov/office-of-the-mayor/news/735-22/mayor-adams-signs-two-bills-dam-additional-rivers-feeding-sea-gun-violence#/0), October 2022

### Get a good night's sleep, nothing good happens after midnight: Time of shootings

Distribution of OCCUR_TIME conditioned on the boroughs :

```{r}
clean_data |>
  #select(OCCUR_TIME) |>
  mutate("hour"=hour(OCCUR_TIME)) |>
  ggplot(aes(x=hour)) +
  geom_bar()+
  facet_wrap(~BORO, nrow=4)
```

In the five boroughs, most shootings occur in the evening and at night.

### Who shoots who ?

The data set contains three categorical variables that allow us to analyse the profiles of offenders and victims : sex, age group and race.

```{r}
knitr::kable(
head(
clean_data |>
  group_by(VIC_SEX, VIC_RACE, VIC_AGE_GROUP, PERP_SEX, PERP_RACE, PERP_AGE_GROUP) |>
  summarise('Number of shootings'=n()) |>
  arrange(-`Number of shootings`, by_groups=TRUE), n=10)
)
```

Between 2006 and 2022, black males aged between 25 and 44 were the victims of the most shootings, but it also them who committed the most shootings (right after NA values).

#### Age groups

PERP_AGE_GROUP conditioned on VIC_AGE_GROUP

```{r}
clean_data |>
  select(VIC_AGE_GROUP, PERP_AGE_GROUP) |> 
  filter(!is.na(VIC_AGE_GROUP) & !is.na(PERP_AGE_GROUP)) |>
  ggplot(aes(x=VIC_AGE_GROUP, fill= PERP_AGE_GROUP)) + 
  geom_bar(position="fill") +
  geom_text(aes(label=after_stat(count)), stat="count", position=position_fill(vjust=0.5))

```

When not taking NA values into account :

Most victims, regardless of their age group, are mostly shot by people aged between 18-24 and 25-44.

However, as a victim gets older, it becomes more likely that they are shot by an older person (aged 45-64 or 65+) and less likely that they are shot by a younger person (\<18). Conversely, younger victims are those who are the most likely to get shot by teenagers.

#### Sex

VIC_SEX conditioned on PERP_SEX :

```{r}
clean_data |>
  select(VIC_SEX, PERP_SEX) |> 
  filter(!is.na(VIC_SEX) & !is.na(PERP_SEX)) |>
  ggplot(aes(x=PERP_SEX, fill=VIC_SEX)) + 
  geom_bar(position="fill") +
  geom_text(aes(label=..count..), stat="count", position=position_fill(vjust=0.5))
```

When not taking NA values into account : most shootings are committed by men, and most of the victims of shootings (whether they are committed by men or women) are also men.

#### Is gun violence inclusive? Shootings between and across racial groups

PERP_RACE conditioned on VIC_RACE

```{r}
clean_data |>
  select(VIC_RACE, PERP_RACE) |> 
  filter(!is.na(VIC_RACE) & !is.na(PERP_RACE)) |>
  ggplot(aes(y=VIC_RACE, fill=PERP_RACE)) + 
  geom_bar(position="fill")
  #options(repr.plot.width=15, repr.plot.height=8)
```

Again, not taking NA values into account :

There seems to be a link between the races of victims and offenders. A victim of a given race is more likely to be shot by someone of that same race than a victim of any another race. For example, a white victim is more likely to get shot by a white offender than a black or a white Hispanic victim. This observation isn't true for American Indian/Alaskan native victims, but the number of shootings involving them is also small (only 4 observations).

```{r}
clean_data |>
  select(VIC_RACE, PERP_RACE) |> 
  filter(!is.na(VIC_RACE) & !is.na(PERP_RACE) & VIC_RACE == "AMERICAN INDIAN/ALASKAN NATIVE") |>
  group_by(VIC_RACE, PERP_RACE) |>
  summarise('Number of SHootings'=n())
```

Furthermore, all races of victims are quite likely to be shot by a black offender (green areas take sufficient space for all victims).

PERP_RACE conditioned on VIC_RACE and BORO

```{r}

clean_data |>
  select(VIC_RACE, PERP_RACE, BORO) |> 
  filter(!is.na(VIC_RACE) & !is.na(PERP_RACE)) |>
  ggplot(aes(y=VIC_RACE, fill=PERP_RACE)) + 
  geom_bar(position="fill") +
  theme(text=element_text(size=8)) +
  facet_wrap(~BORO, nrow=5)

```

The same observation as before can be made here : in all boroughs (except for Staten Island, which is also the borough with the less shooting incidents, cf graph of shooting incidents over the years by boroughs) a victim of a given race is more likely to be shot by someone of that same race than a victim of another race. This is particularly visible for black victims who in all boroughs are very likely to get shot by a black offender.

Again, all races of victims are quite likely to be shot by a black offender in all boroughs (except for Asian/Pacific Islander in Staten Island).

### Stay home, be safe... or don't?

```{r}
clean_data |>
  distinct(LOCATION_DESC) 
```

```{r}
clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUSE" =  "Home",
                                "MULTI DWELL - APT BUILD" = "Home",
                                "PVT HOUSE" = "Home",
                                "SMALL MERCHANT" = "Commerce",
                                "HOTEL/MOTEL" = "Hotel",
                                "HOSPITAL" = "Hospital",
                                "BAR/NIGHT CLUB" = "Night life",
                                "BEAUTY/NAIL SALON" = "Commerce",
                                "STORE UNCLASSIFIED" = "Store",
                                "RESTAURANT/DINER" = "Restaurant",
                                "GROCERY/BODEGA" = "Store",
                                "SOCIAL CLUB/POLICY LOCATION" = "Misc",
                                "JEWELRY STORE" = "Store",
                                "COMMERCIAL BLDG" = "Commerce",
                                "SUPERMARKET" = "Store",
                                "DRY CLEANER/LAUNDRY" = "Commerce",
                                "GAS STATION" = "Commerce",
                                "LIQUOR STORE" = "Store",
                                "CLOTHING BOUTIQUE" = "Store",
                                "FACTORY/WAREHOUSE" = "Commerce",
                                "FAST FOOD" = "Store",
                                "DRUG STORE" = "Store",				
                                "CHECK CASH" = "Finance",				
                                "VARIETY STORE" = "Store",				
                                "BANK" = "Finance",				
                                "ATM" = "Finance",				
                                "CANDY STORE" = "Store",			
                                "VIDEO STORE" = "Store",				
                                "SHOE STORE" = "Store",
                                "PHOTO/COPY STORE" = "Store",				
                                "DEPT STORE" = "Store",				
                                "GYM/FITNESS FACILITY" = "Commerce",				
                                "CHAIN STORE" = "Store",				
                                "DOCTOR/DENTIST" = "Commerce",				
                                "TELECOMM. STORE" = "Store",				
                                "LOAN COMPANY" = "Commerce",				
                                "SCHOOL" = "School",				
                                "STORAGE FACILITY" = "Misc")) |>
  filter(!is.na(LOCATION_DESC)) |>
  ggplot(aes(x=LOCATION_DESC)) +
  geom_bar()

```

```{r}
clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUSE" =  "Home",
                                "MULTI DWELL - APT BUILD" = "Home",
                                "PVT HOUSE" = "Home",
                                "SMALL MERCHANT" = "Commerce",
                                "HOTEL/MOTEL" = "Hotel",
                                "HOSPITAL" = "Hospital",
                                "BAR/NIGHT CLUB" = "Night life",
                                "BEAUTY/NAIL SALON" = "Commerce",
                                "STORE UNCLASSIFIED" = "Store",
                                "RESTAURANT/DINER" = "Restaurant",
                                "GROCERY/BODEGA" = "Store",
                                "SOCIAL CLUB/POLICY LOCATION" = "Misc",
                                "JEWELRY STORE" = "Store",
                                "COMMERCIAL BLDG" = "Commerce",
                                "SUPERMARKET" = "Store",
                                "DRY CLEANER/LAUNDRY" = "Commerce",
                                "GAS STATION" = "Commerce",
                                "LIQUOR STORE" = "Store",
                                "CLOTHING BOUTIQUE" = "Store",
                                "FACTORY/WAREHOUSE" = "Commerce",
                                "FAST FOOD" = "Store",
                                "DRUG STORE" = "Store",				
                                "CHECK CASH" = "Finance",				
                                "VARIETY STORE" = "Store",				
                                "BANK" = "Finance",				
                                "ATM" = "Finance",				
                                "CANDY STORE" = "Store",			
                                "VIDEO STORE" = "Store",				
                                "SHOE STORE" = "Store",
                                "PHOTO/COPY STORE" = "Store",				
                                "DEPT STORE" = "Store",				
                                "GYM/FITNESS FACILITY" = "Commerce",				
                                "CHAIN STORE" = "Store",				
                                "DOCTOR/DENTIST" = "Commerce",				
                                "TELECOMM. STORE" = "Store",				
                                "LOAN COMPANY" = "Commerce",				
                                "SCHOOL" = "School",				
                                "STORAGE FACILITY" = "Misc")) |>
  filter(!is.na(LOCATION_DESC) & !is.na(PERP_RACE)) |>
  ggplot(aes(x=LOCATION_DESC)) +
  geom_bar() +
  facet_wrap(~ PERP_RACE, nrow = 6)
```

```{r}
clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUSE" =  "Home",
                                "MULTI DWELL - APT BUILD" = "Home",
                                "PVT HOUSE" = "Home",
                                "SMALL MERCHANT" = "Commerce",
                                "HOTEL/MOTEL" = "Hotel",
                                "HOSPITAL" = "Hospital",
                                "BAR/NIGHT CLUB" = "Night life",
                                "BEAUTY/NAIL SALON" = "Commerce",
                                "STORE UNCLASSIFIED" = "Store",
                                "RESTAURANT/DINER" = "Restaurant",
                                "GROCERY/BODEGA" = "Store",
                                "SOCIAL CLUB/POLICY LOCATION" = "Misc",
                                "JEWELRY STORE" = "Store",
                                "COMMERCIAL BLDG" = "Commerce",
                                "SUPERMARKET" = "Store",
                                "DRY CLEANER/LAUNDRY" = "Commerce",
                                "GAS STATION" = "Commerce",
                                "LIQUOR STORE" = "Store",
                                "CLOTHING BOUTIQUE" = "Store",
                                "FACTORY/WAREHOUSE" = "Commerce",
                                "FAST FOOD" = "Store",
                                "DRUG STORE" = "Store",				
                                "CHECK CASH" = "Finance",				
                                "VARIETY STORE" = "Store",				
                                "BANK" = "Finance",				
                                "ATM" = "Finance",				
                                "CANDY STORE" = "Store",			
                                "VIDEO STORE" = "Store",				
                                "SHOE STORE" = "Store",
                                "PHOTO/COPY STORE" = "Store",				
                                "DEPT STORE" = "Store",				
                                "GYM/FITNESS FACILITY" = "Commerce",				
                                "CHAIN STORE" = "Store",				
                                "DOCTOR/DENTIST" = "Commerce",				
                                "TELECOMM. STORE" = "Store",				
                                "LOAN COMPANY" = "Commerce",				
                                "SCHOOL" = "School",				
                                "STORAGE FACILITY" = "Misc")) |>
  filter(!is.na(LOCATION_DESC)) |>
  ggplot(aes(x=LOCATION_DESC)) +
  geom_bar() +
  facet_wrap(~ BORO, nrow = 5)
```

Location as a percentage of the shootings in each neighbourhood.

```{r}
knitr::kable(
  clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUSE" =  "Home",
                                "MULTI DWELL - APT BUILD" = "Home",
                                "PVT HOUSE" = "Home",
                                "SMALL MERCHANT" = "Commerce",
                                "HOTEL/MOTEL" = "Hotel",
                                "HOSPITAL" = "Hospital",
                                "BAR/NIGHT CLUB" = "Night life",
                                "BEAUTY/NAIL SALON" = "Commerce",
                                "STORE UNCLASSIFIED" = "Store",
                                "RESTAURANT/DINER" = "Restaurant",
                                "GROCERY/BODEGA" = "Store",
                                "SOCIAL CLUB/POLICY LOCATION" = "Misc",
                                "JEWELRY STORE" = "Store",
                                "COMMERCIAL BLDG" = "Commerce",
                                "SUPERMARKET" = "Store",
                                "DRY CLEANER/LAUNDRY" = "Commerce",
                                "GAS STATION" = "Commerce",
                                "LIQUOR STORE" = "Store",
                                "CLOTHING BOUTIQUE" = "Store",
                                "FACTORY/WAREHOUSE" = "Commerce",
                                "FAST FOOD" = "Store",
                                "DRUG STORE" = "Store",				
                                "CHECK CASH" = "Finance",				
                                "VARIETY STORE" = "Store",				
                                "BANK" = "Finance",				
                                "ATM" = "Finance",				
                                "CANDY STORE" = "Store",			
                                "VIDEO STORE" = "Store",				
                                "SHOE STORE" = "Store",
                                "PHOTO/COPY STORE" = "Store",				
                                "DEPT STORE" = "Store",				
                                "GYM/FITNESS FACILITY" = "Commerce",				
                                "CHAIN STORE" = "Store",				
                                "DOCTOR/DENTIST" = "Commerce",				
                                "TELECOMM. STORE" = "Store",				
                                "LOAN COMPANY" = "Commerce",				
                                "SCHOOL" = "School",				
                                "STORAGE FACILITY" = "Misc")) |>
  filter(!is.na(LOCATION_DESC) & !is.na(BORO) & !is.na(PERP_SEX)) |>
  group_by(BORO, LOCATION_DESC) |>
  summarise('Number of shootings'= n()) |>
  group_by(BORO) |>
  mutate('pct' = (round(`Number of shootings`/sum(`Number of shootings`), 2)))
)
```

We see that no matter which bourough, a vast majority (almost 80%) of shootings happen in homes.
