---
title: "NewYorkShootings"
author: "Brian de Korodi & Mariane Modena"
format: pdf
editor: visual
---

# Gun violence in the Big Apple: How shooting incidents help to tell the story of New York City over the last 15 years.

A city of bright lights and big dreams, New York's history is also one of crime, violence and social inequality. This is why we will attempt to tell the story of New York City through the lens of its shooting incidents.

Through geographical, sociodemographic and temporal aspects of reported shooting incidents in New York City, we attempt to find relevant trends that might align with social and economic developments between 2006 and 2022.

We have found certified data with detailed descriptive characteristics of all reported shooting incidents, including date, time, location, victim and offender's characteristics. This will allow us to summarize the quantity of shooting incidents as a function of these characteristics, along with their evolution over the given timeframe. Where significant patterns reveal themselves, we will attempt to use external information to help explain these patterns in light of various contextual factors, such as political, social, or economic evolutions.Â 

This method, combining descriptive data with contextual information, we hope, will allow us to determine to what extent gun violence incidents are random events, or whether they may be partially explained by larger social and economic forces.

## Click [here](https://github.com/briandekorodi/NewYorkShootings) to access the Github repository

## Click [here](https://catalog.data.gov/dataset/nypd-shooting-incident-data-historic/resource/c564b578-fd8a-4005-8365-34150d306cc4) to access the source

## Description of the source

The data, found in the official United States open data website, constitutes a list of every New York City shooting incident, reported by the NYPD, from January 1, 2006 to Decemeber 31, 2022. This data is manually extracted every quarter and reviewed by the Office of Management Analysis and Planning before being posted on the NYPD website.

For each observation, corresponding to a unique shooting incident, is provided information relative to the date, time and localisation of the incident, as well as socio-demographic characteristics of the offender and victim.

## Description of the variables

**INCIDENT_KEY** : Serial number identifying the incident

**OCCUR_DATE** : Date (Month/Day/Year) on which the incident occurred

**OCCUR_TIME** : Time at which the incident occured

**BORO** : Which of the 5 New York City boroughs the incident occurred in (Manhattan, Queens, Brooklyn, Bronx, Staten Island)

**LOC_OF_OCCUR_DESC** : Most general category of location, whether the incident occurred inside ,outside, or unknown

**PRECINCT** : Code identifying which NYPD precinct in which the incident occurred

**JURISDICTION_CODE** : Code identifying the tax jurisdiction territory in which the incident occurred

**LOC_CLASSFCTN_DESC** : Second most general category of location

**LOCATION_DESC** : Third most general category of location

**STATISTICAL_MURDER_FLAG** : TRUE/FALSE variable indicating whether the shooting resulted in a murder

**PERP_AGE_GROUP** : Age range of the offender

**PERP_SEX** : Sex of the offender

**PERP_RACE** : Racial group of the offender

**VIC_AGE_GROUP** : Age range of the victim

**VIC_SEX** : Sex of the victim

**VIC_RACE** : Racial group of the victim

**X_COORD_CD** : Cartesian X coordinate of the location at which the shooting incident occurred

**Y_COORD_CD** : Cartesian Y coordinate of the location at which the shooting incident occurred

**Latitude** : Geographical latitude coordinate of the location at which the shooting incident occurred

**Longitude** : Geographical longitude coordinate of the location at which the shooting incident occurred

**Lon_Lat** : Geographical point, composed of latitude and longitude coordinates, of the location at which the shooting incident occurred

## Loading the data

```{r}
#| message: FALSE
here::i_am("NewYorkShootings.Rproj")
```

```{r}
library(vroom)
```

```{r}

raw_data <- vroom("data/NYPD_Shooting_Incident_Data__Historic.csv")
```

## Data Cleaning

```{r}
library(dplyr)
```

We create a new dataset on which we will implement our cleaning steps.

```{r}
clean_data <- raw_data
```

### Inconsistent labeling of missing values

The dataset contains some inconsistencies in the entry of missing values. Some missing values are labeled NA, while others are labeled with some other character value, such as "(null)", "UNKNOWN", "U", or "OTHER". We convert all of these to NA.

#### Null

The location description and offender age group variables contain missing values that have the notation "(null)".

```{r}
clean_data |> distinct(LOCATION_DESC)
```

```{r}
clean_data |> distinct(PERP_AGE_GROUP)
```

We replace all the "(null)" values in the dataset by NA.

```{r}
clean_data[clean_data == "(null)"] <- NA
```

#### NONE

The location description variable contains some missing values labeled as NONE. We replace these by NA.

```{r}
clean_data[clean_data == "NONE"] <- NA
```

#### UNKNOWN

The victim age group variable contains some missing values labeled as UNKNOWN. We replace these by NA.

```{r}
clean_data |> distinct(VIC_AGE_GROUP)
```

```{r}
clean_data |> distinct(PERP_AGE_GROUP)
```

```{r}
clean_data[clean_data == "UNKNOWN"] <- NA
```

#### OTHER

The location classification variable contains some missing values labeled as OTHER. We replace these by NA.

```{r}
clean_data |> distinct(LOC_CLASSFCTN_DESC)
```

```{r}
clean_data[clean_data == "OTHER"] <- NA
```

#### U

The victim and offender sex variables contain some missing values labeled as U. We replace these by NA.

```{r}
clean_data |> distinct(PERP_SEX)
```

```{r}
clean_data |> distinct(VIC_SEX)
```

```{r}
clean_data[clean_data == "U"] <- NA
```

### Impossible values

The victim and offender age group variables contain some absurd values. It is impossible that the victim's age be 1022, or that the offender's age be 1020, 940 or 224. We replace these values by NA.

```{r}
clean_data |> distinct(VIC_AGE_GROUP)
```

```{r}
clean_data |> distinct(PERP_AGE_GROUP)
```

```{r}
clean_data <- clean_data |>
  mutate(VIC_AGE_GROUP = ifelse(!VIC_AGE_GROUP %in% c("<18", "18-24", "25-44", "45-64", "65+"), NA, VIC_AGE_GROUP),
         PERP_AGE_GROUP = ifelse(!PERP_AGE_GROUP %in% c("<18", "18-24", "25-44", "45-64", "65+"), NA, PERP_AGE_GROUP))
```

### Typos

The location description variable contains some values with typos. We correct these.

```{r}
clean_data |> distinct(LOCATION_DESC)
```

```{r}
clean_data <- clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUS" =  "MULTI DWELL - PUBLIC HOUSE", 
                                "SOCIAL CLUB/POLICY LOCATI" = "SOCIAL CLUB/POLICY LOCATION"))
```

### Wrong types

Depending on the computer, he variable OCCUR_TIME may have a double type, which means its values take on a "... secs" format, rather than a "hours/minutes/seconds" format. This not very readable.

```{r}
#In case this issue arises
#clean_data[["OCCUR_TIME"]] |> typeof()
```

We us as_hms to convert it from double to time.

```{r}
#In case this issue arises
library(hms)
clean_data[["OCCUR_TIME"]] <- clean_data[["OCCUR_TIME"]] |> as_hms()
```

we change the type of OCCUR_DATE from character to date.

```{r}
clean_data[["OCCUR_DATE"]] <- clean_data[["OCCUR_DATE"]] |> as.Date(format="%m/%d/%Y")
```

## Basic information about the data file

```{r}
basic_info <- clean_data |>
  summarise("Name of the file" = gsub(".csv","", list.files("data")),
            "File content" = "Reported shooting incidents in New York City",
            "Number of observations" = nrow(clean_data),
            "Number of variables" = ncol(clean_data),
            "Date of first observation" = last(OCCUR_DATE),
            "Date of last observation" = first(OCCUR_DATE),
            "Number of numerical variables" = length(select_if(clean_data,is.numeric)),
            "Number of character variables" = length(select_if(clean_data,is.character)),
            "Number of logical variables" = length(select_if(clean_data,is.logical)),
            "Number of time variables" = length(select_if(clean_data,is_hms)),
            "Proportion of missing values" = (sum(is.na(clean_data)))/((nrow(clean_data))*(ncol(clean_data))))
knitr::kable(basic_info)

```

## A first look

```{r}
library(ggplot2)
```

```{r}
clean_data |>
  filter(!is.na(Longitude) & !is.na(Latitude)) |>
  ggplot(aes(x=Longitude, y=Latitude, color=BORO))+
  geom_point() +
  labs(title = "Locations of shooting incidents in New York City, 2006-2022")
```

![Map of New York City](NYC_Map.png){fig-align="center" width="310"}

Nothing illustrates the tight link between New York City and its history of gun violence quite like the near reproduction of the city map simply by plotting all shooting incidents according to their geographical coordinates.

On this note, we will attempt to further deconstruct the patterns behind this remarkable data.

### Shootings over time in New York City

Without any grouping :

```{r}
library(lubridate)

clean_data |>
  mutate("year"=year(OCCUR_DATE)) |>
  #filter(year == 2020) |>
  group_by(OCCUR_DATE) |>
  summarise("Shooting incidents" = n()) |>
  ggplot(aes(x = `OCCUR_DATE`, y = `Shooting incidents`)) +
  geom_line() 
```

clearly there are too many dates...

Grouping by year :

```{r}
library(lubridate)

  clean_data |>
  select(OCCUR_DATE) |>
  mutate('year'=year(OCCUR_DATE))|>
  group_by(year)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=1))) +
    labs(title="Number of shooting incidents in NYC over the years ")
```

Grouping by year and by Boroughs :

```{r}
 clean_data |>
  select(OCCUR_DATE, BORO) |>
  mutate('year'=year(OCCUR_DATE))|>
  group_by(year, BORO)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`, group=BORO, color=BORO)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=2))) +
    labs(title="Number of shooting incidents by boroughs over the years ")
```

### It's cold outside: Average shootings by month of the year

```{r}
months_association <- data.frame("month name"=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), "month"=c(1,2,3,4,5,6,7,8,9,10,11,12)
)
```

```{r}
library(tidyverse) 

clean_data |>
  select(OCCUR_DATE) |>
  mutate('month'=month(OCCUR_DATE))|>
  group_by(month)|>
  summarise('Average number of shooting incidents'= n()/16) |>
  left_join(months_association) |>
  ggplot(aes(x=fct_inorder(month.name), y=`Average number of shooting incidents`)) +
  geom_col() +
  labs(x="Month", title="Average number of shooting incidents per month in NYC", subtitle="over the period 2006-2022")
```

### Shooting incidents in NYC during each US President's term

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)

presidents <- clean_data |>
  select(OCCUR_DATE) |>
  mutate('year'=year(OCCUR_DATE))|>
  group_by(year)|>
  summarise('Number of shootings'= n()) |>
  ggplot(aes(x=year, y=`Number of shootings`)) +
    geom_line() + 
    geom_point() +
    scale_x_continuous(breaks=c(seq(2006,2022,by=1))) +
    labs(title="Number of shooting incidents in NYC over the years ") +
    geom_vline(xintercept = 2006) +
    geom_vline(xintercept = 2009) +
    geom_vline(xintercept = 2017) +
    geom_vline(xintercept = 2019) +
    geom_vline(xintercept = 2021)
  
install.packages("png")
library(png)

here::i_am("NewYorkShootings.Rproj")


Bush_img <- readPNG("pngimg.com - geaorge_bush_PNG16.png", native = TRUE)
Obama_img <- readPNG("pngwing.com.png", native = TRUE)
Trump_img <- readPNG("trump.png", native = TRUE)
Covid_img <- readPNG("covid.png", native = TRUE)
Biden_img <- readPNG("joe-biden-40972.png", native = TRUE)


install.packages("patchwork")
library(patchwork)

presidents_img <- presidents +                   
  inset_element(p = Bush_img, 
                left = 0.1, 
                bottom = 0.5, 
                right = 0.2, 
                top = 0.35) +                   
  inset_element(p = Obama_img, 
                left = 0.25, 
                bottom = 0.5, 
                right = 0.4, 
                top = 0.01) +                   
  inset_element(p = Trump_img,
                left = 0.8, 
                bottom = 0.2, 
                right = 0.75, 
                top = 0.7) +                   
  inset_element(p = Covid_img, 
                left = 0.9, 
                bottom = 0.6, 
                right = 0.8, 
                top = 0.7) +                   
  inset_element(p = Biden_img, 
                left = 0.91, 
                bottom = 0.4, 
                right = 0.99, 
                top = 0.65) 

print(presidents_img)


```

### Get a good night's sleep, nothing good happens after midnight: Time of shootings

Distribution of OCCUR_TIME conditioned on the boroughs :

```{r}
clean_data |>
  #select(OCCUR_TIME) |>
  mutate("hour"=hour(OCCUR_TIME)) |>
  ggplot(aes(x=hour)) +
  geom_bar()+
  facet_wrap(~BORO, nrow=4)
```

In the five boroughs, most shootings occur in the evening and at night.

### Who shoots who ?

The data set contains three categorical variables that allow us to analyse the profiles of offenders and victims : sex, age group and race.

```{r}
knitr::kable(
head(
clean_data |>
  group_by(VIC_SEX, VIC_RACE, VIC_AGE_GROUP, PERP_SEX, PERP_RACE, PERP_AGE_GROUP) |>
  summarise('Number of shootings'=n()) |>
  arrange(-`Number of shootings`, by_groups=TRUE), n=10)
)
```

Between 2006 and 2022, black males aged between 25 and 44 were the victims of the most shootings, but it also them who committed the most shootings (right after NA values).

#### Age groups

PERP_AGE_GROUP conditioned on VIC_AGE_GROUP

```{r}
clean_data |>
  select(VIC_AGE_GROUP, PERP_AGE_GROUP) |> 
  filter(!is.na(VIC_AGE_GROUP) & !is.na(PERP_AGE_GROUP)) |>
  ggplot(aes(x=VIC_AGE_GROUP, fill=PERP_AGE_GROUP)) + 
  geom_bar(position="fill") +
  geom_text(aes(label=after_stat(count)), stat="count", position=position_fill(vjust=0.5))

```

When not taking NA values into account :

Most victims, regardless of their age group, are mostly shot by people aged between 18-24 and 25-44.

However, as a victim gets older, it becomes more likely that they are shot by an older person (aged 45-64 or 65+) and less likely that they are shot by a younger person (\<18). Conversely, younger victims are those who are the most likely to get shot by teenagers.

#### Sex

VIC_SEX conditioned on PERP_SEX :

```{r}
clean_data |>
  select(VIC_SEX, PERP_SEX) |> 
  filter(!is.na(VIC_SEX) & !is.na(PERP_SEX)) |>
  ggplot(aes(x=PERP_SEX, fill=VIC_SEX)) + 
  geom_bar(position="fill") +
  geom_text(aes(label=..count..), stat="count", position=position_fill(vjust=0.5))
```

When not taking NA values into account : most shootings are committed by men, and most of the victims of shootings (whether they are committed by men or women) are also men.

#### Is gun violence inclusive? Shootings between and across racial groups

PERP_RACE conditioned on VIC_RACE

```{r}
clean_data |>
  select(VIC_RACE, PERP_RACE) |> 
  filter(!is.na(VIC_RACE) & !is.na(PERP_RACE)) |>
  ggplot(aes(y=VIC_RACE, fill=PERP_RACE)) + 
  geom_bar(position="fill")
  #options(repr.plot.width=15, repr.plot.height=8)
```

Again, not taking NA values into account :

There seems to be a link between the races of victims and offenders. A victim of a given race is more likely to be shot by someone of that same race than a victim of any another race. For example, a white victim is more likely to get shot by a white offender than a black or a white Hispanic victim. This observation isn't true for American Indian/Alaskan native victims, but the number of shootings involving them is also small (only 4 observations).

```{r}
clean_data |>
  select(VIC_RACE, PERP_RACE) |> 
  filter(!is.na(VIC_RACE) & !is.na(PERP_RACE) & VIC_RACE == "AMERICAN INDIAN/ALASKAN NATIVE") |>
  group_by(VIC_RACE, PERP_RACE) |>
  summarise('Number of SHootings'=n())
```

Furthermore, all races of victims are quite likely to be shot by a black offender (green areas take sufficient space for all victims).

PERP_RACE conditioned on VIC_RACE and BORO

```{r}

clean_data |>
  select(VIC_RACE, PERP_RACE, BORO) |> 
  filter(!is.na(VIC_RACE) & !is.na(PERP_RACE)) |>
  ggplot(aes(y=VIC_RACE, fill=PERP_RACE)) + 
  geom_bar(position="fill") +
  theme(text=element_text(size=8)) +
  facet_wrap(~BORO, nrow=5)

```

The same observation as before can be made here : in all boroughs (except for Staten Island, which is also the borough with the less shooting incidents, cf graph of shooting incidents over the years by boroughs) a victim of a given race is more likely to be shot by someone of that same race than a victim of another race. This is particularly visible for black victims who in all boroughs are very likely to get shot by a black offender.

Again, all races of victims are quite likely to be shot by a black offender in all boroughs (except for Asian/Pacific Islander in Staten Island).

### Stay home, be safe... or don't?

```{r}
clean_data |>
  distinct(LOCATION_DESC) 
```

```{r}
clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUSE" =  "Home",
                                "MULTI DWELL - APT BUILD" = "Home",
                                "PVT HOUSE" = "Home",
                                "SMALL MERCHANT" = "Commerce",
                                "HOTEL/MOTEL" = "Hotel",
                                "HOSPITAL" = "Hospital",
                                "BAR/NIGHT CLUB" = "Night life",
                                "BEAUTY/NAIL SALON" = "Commerce",
                                "STORE UNCLASSIFIED" = "Store",
                                "RESTAURANT/DINER" = "Restaurant",
                                "GROCERY/BODEGA" = "Store",
                                "SOCIAL CLUB/POLICY LOCATION" = "Misc",
                                "JEWELRY STORE" = "Store",
                                "COMMERCIAL BLDG" = "Commerce",
                                "SUPERMARKET" = "Store",
                                "DRY CLEANER/LAUNDRY" = "Commerce",
                                "GAS STATION" = "Commerce",
                                "LIQUOR STORE" = "Store",
                                "CLOTHING BOUTIQUE" = "Store",
                                "FACTORY/WAREHOUSE" = "Commerce",
                                "FAST FOOD" = "Store",
                                "DRUG STORE" = "Store",				
                                "CHECK CASH" = "Finance",				
                                "VARIETY STORE" = "Store",				
                                "BANK" = "Finance",				
                                "ATM" = "Finance",				
                                "CANDY STORE" = "Store",			
                                "VIDEO STORE" = "Store",				
                                "SHOE STORE" = "Store",
                                "PHOTO/COPY STORE" = "Store",				
                                "DEPT STORE" = "Store",				
                                "GYM/FITNESS FACILITY" = "Commerce",				
                                "CHAIN STORE" = "Store",				
                                "DOCTOR/DENTIST" = "Commerce",				
                                "TELECOMM. STORE" = "Store",				
                                "LOAN COMPANY" = "Commerce",				
                                "SCHOOL" = "School",				
                                "STORAGE FACILITY" = "Misc")) |>
    filter(!is.na(LOCATION_DESC)) |>
  ggplot(aes(x=LOCATION_DESC)) +
  geom_bar()

```

```{r}
clean_data |>
  mutate(LOCATION_DESC = recode(LOCATION_DESC, "MULTI DWELL - PUBLIC HOUSE" =  "Home",
                                "MULTI DWELL - APT BUILD" = "Home",
                                "PVT HOUSE" = "Home",
                                "SMALL MERCHANT" = "Commerce",
                                "HOTEL/MOTEL" = "Hotel",
                                "HOSPITAL" = "Hospital",
                                "BAR/NIGHT CLUB" = "Night life",
                                "BEAUTY/NAIL SALON" = "Commerce",
                                "STORE UNCLASSIFIED" = "Store",
                                "RESTAURANT/DINER" = "Restaurant",
                                "GROCERY/BODEGA" = "Store",
                                "SOCIAL CLUB/POLICY LOCATION" = "Misc",
                                "JEWELRY STORE" = "Store",
                                "COMMERCIAL BLDG" = "Commerce",
                                "SUPERMARKET" = "Store",
                                "DRY CLEANER/LAUNDRY" = "Commerce",
                                "GAS STATION" = "Commerce",
                                "LIQUOR STORE" = "Store",
                                "CLOTHING BOUTIQUE" = "Store",
                                "FACTORY/WAREHOUSE" = "Commerce",
                                "FAST FOOD" = "Store",
                                "DRUG STORE" = "Store",				
                                "CHECK CASH" = "Finance",				
                                "VARIETY STORE" = "Store",				
                                "BANK" = "Finance",				
                                "ATM" = "Finance",				
                                "CANDY STORE" = "Store",			
                                "VIDEO STORE" = "Store",				
                                "SHOE STORE" = "Store",
                                "PHOTO/COPY STORE" = "Store",				
                                "DEPT STORE" = "Store",				
                                "GYM/FITNESS FACILITY" = "Commerce",				
                                "CHAIN STORE" = "Store",				
                                "DOCTOR/DENTIST" = "Commerce",				
                                "TELECOMM. STORE" = "Store",				
                                "LOAN COMPANY" = "Commerce",				
                                "SCHOOL" = "School",				
                                "STORAGE FACILITY" = "Misc")) |>
  filter(!is.na(LOCATION_DESC)) |>
  ggplot(aes(x=LOCATION_DESC)) +
  geom_bar() +
  facet_wrap(~BORO, nrow = 5)
```
